# BA-Agent Python 沙盒镜像
#
# 包含数据分析所需的所有库
# 用于安全执行 Python 代码

FROM python:3.12-slim

# 设置工作目录
WORKDIR /app

# 安装 Python 数据分析库
#
# 说明：
# - 之前使用清华源（pypi.tuna.tsinghua.edu.cn）在部分网络环境会超时。
# - 这里改为可配置的镜像源，并增加 timeout / retries，提高构建稳定性。
ARG PIP_INDEX_URL=https://mirrors.aliyun.com/pypi/simple
RUN pip install --no-cache-dir --upgrade pip --timeout 120 --retries 10 -i ${PIP_INDEX_URL} && \
    pip install --no-cache-dir --timeout 120 --retries 10 -i ${PIP_INDEX_URL} \
    pandas \
    numpy \
    scipy \
    statsmodels \
    scikit-learn \
    openpyxl \
    xlrd \
    xlsxwriter \
    matplotlib \
    seaborn

# 创建非 root 用户
RUN useradd -m -u 1000 baagent && \
    chown -R baagent:baagent /app

USER baagent

# 验证安装
RUN python -c "import pandas, numpy, scipy, statsmodels, openpyxl; print('All libraries installed successfully')"

CMD ["python", "--version"]
