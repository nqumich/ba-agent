# BA-Agent Progress Log

Started: 2025-02-04

## Codebase Patterns
- 项目结构：backend/ (核心代码), config/ (配置), skills/ (可配置Skills), docs/ (文档)
- 所有工具继承自 `langchain_core.tools.StructuredTool` (注意：不是 langchain.tools)
- Agent创建使用 `langgraph.prebuilt.create_react_agent` (LangChain 1.2.x 推荐方式)
- 所有Skills通过 `config/skills.yaml` 注册
- 使用 Pydantic 定义所有数据模型
- Docker隔离用于代码执行
- 本地隔离环境替代云端虚拟机

## MCP Tools (已配置)
- `mcp__web-search-prime__webSearchPrime`: Web搜索功能
- `mcp__web_reader__webReader`: 网页内容提取功能

## Supported AI Models
- Claude (Anthropic): anthropic>=0.40.0
- OpenAI (GPT): openai>=1.0.0
- Google Gemini: google-genai>=1.0.0
- 智谱 AI (GLM-4.7): zhipuai>=2.0.0

## Key Files
- backend/agents/agent.py (主Agent)
- backend/tools/ (基础工具)
- skills/ (可配置分析Skills)
- config/skills.yaml (Skills配置)

---

## [2025-02-04] - LangChain 1.2.x API 修复完成
- **任务**: 修复 LangChain 1.2.x API 兼容性问题
- **文件变更**: requirements.txt, scripts/ralph/prd.json, scripts/ralph/prompt.md
- **完成标准**:
  - ✅ 安装 langchain>=0.3.0, langgraph>=0.2.0, langchain-anthropic>=0.2.0
  - ✅ 更新 US-004 使用 langchain.agents.create_agent (新推荐方式)
  - ✅ 更新所有工具的 US-006~US-013 使用 langchain_core.tools.StructuredTool
  - ✅ 更新 prompt.md 添加正确的 LangChain 1.2.8+ API 示例
  - ✅ 验证所有 API 导入和创建正常工作
- **Learnings**:
  - LangChain 1.2.x 弃用了 langchain.agents.AgentExecutor
  - 新推荐方式: `langchain.agents.create_agent`
  - 备选方式: `langgraph.prebuilt.create_react_agent` (有弃用警告但仍可用)
  - StructuredTool 从 langchain.tools 移至 langchain_core.tools
  - 需要使用 MemorySaver checkpointer 支持对话历史
  - 必须安装完整的 langchain 包 (不只是 langchain-core)

---

## [2025-02-04] - 依赖安装完成
- **任务**: 安装所有Python依赖
- **文件变更**: requirements.txt, .env.example
- **完成标准**:
  - ✅ 核心框架: langchain, anthropic, fastapi
  - ✅ AI模型: Claude, OpenAI, Gemini, GLM-4.7 (zhipuai)
  - ✅ 数据分析: pandas, numpy, scipy
  - ✅ 科学统计: statsmodels, scikit-learn, sympy, patsy
  - ✅ Excel处理: openpyxl, xlrd, xlwt, xlsxwriter
  - ✅ 可视化: plotly, matplotlib, kaleido
  - ✅ 报告生成: python-docx, reportlab
- **Learnings**:
  - 使用清华 PyPI 镜像源加速安装
  - google-genai (新SDK) 替代已弃用的 google-generativeai
  - Python 3.14 ARM64 暂不支持 chromadb (缺少 onnxruntime)

---
